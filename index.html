<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Latiao –§—ñ–Ω–∞–Ω—Å–∏ v3.1 (Ultimate)</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        
        body { background-color: #F8FAFC; font-family: 'Inter', sans-serif; color: #0F172A; }
        
        /* Brand Colors */
        .text-latiao { color: #FF5722; }
        .bg-latiao { background-color: #FF5722; }
        .border-latiao { border-color: #FF5722; }
        
        /* Animations */
        .animate-fade-in { animation: fadeIn 0.4s ease-out forwards; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        /* Money Rain Animation */
        @keyframes fall {
            0% { transform: translateY(-100px) rotate(0deg); opacity: 0; }
            10% { opacity: 1; }
            90% { opacity: 1; }
            100% { transform: translateY(110vh) rotate(360deg); opacity: 0; }
        }
        .coin {
            position: fixed;
            top: -100px;
            width: 50px;
            height: 50px;
            background-image: url('https://img1.picmix.com/output/stamp/normal/0/9/1/1/2691190_5accc.png');
            background-size: contain;
            background-repeat: no-repeat;
            z-index: 9999;
            pointer-events: none;
            animation: fall linear infinite;
        }

        /* Scrollbar */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #CBD5E1; border-radius: 3px; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo, useRef } = React;

        // --- ICONS (Safe Inline SVG) ---
        const Icons = {
            Dashboard: () => <svg width="20" height="20" fill="none" stroke="currentColor" strokeWidth="2" viewBox="0 0 24 24"><rect x="3" y="3" width="7" height="7"></rect><rect x="14" y="3" width="7" height="7"></rect><rect x="14" y="14" width="7" height="7"></rect><rect x="3" y="14" width="7" height="7"></rect></svg>,
            List: () => <svg width="20" height="20" fill="none" stroke="currentColor" strokeWidth="2" viewBox="0 0 24 24"><line x1="8" y1="6" x2="21" y2="6"></line><line x1="8" y1="12" x2="21" y2="12"></line><line x1="8" y1="18" x2="21" y2="18"></line><line x1="3" y1="6" x2="3.01" y2="6"></line><line x1="3" y1="12" x2="3.01" y2="12"></line><line x1="3" y1="18" x2="3.01" y2="18"></line></svg>,
            PieChart: () => <svg width="20" height="20" fill="none" stroke="currentColor" strokeWidth="2" viewBox="0 0 24 24"><path d="M21.21 15.89A10 10 0 1 1 8 2.83"></path><path d="M22 12A10 10 0 0 0 12 2v10z"></path></svg>,
            ArrowUpRight: () => <svg width="20" height="20" fill="none" stroke="currentColor" strokeWidth="2" viewBox="0 0 24 24"><line x1="7" y1="17" x2="17" y2="7"></line><polyline points="7 7 17 7 17 17"></polyline></svg>,
            DollarSign: () => <svg width="20" height="20" fill="none" stroke="currentColor" strokeWidth="2" viewBox="0 0 24 24"><line x1="12" y1="1" x2="12" y2="23"></line><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path></svg>,
            Settings: () => <svg width="20" height="20" fill="none" stroke="currentColor" strokeWidth="2" viewBox="0 0 24 24"><circle cx="12" cy="12" r="3"></circle><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path></svg>,
            Search: () => <svg width="18" height="18" fill="none" stroke="currentColor" strokeWidth="2" viewBox="0 0 24 24"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>,
            Calculator: () => <svg width="24" height="24" fill="none" stroke="currentColor" strokeWidth="2" viewBox="0 0 24 24"><rect x="4" y="2" width="16" height="20" rx="2"></rect><line x1="8" y1="6" x2="16" y2="6"></line><line x1="16" y1="14" x2="16" y2="18"></line><path d="M16 10h.01"></path><path d="M12 10h.01"></path><path d="M8 10h.01"></path><path d="M12 14h.01"></path><path d="M8 14h.01"></path><path d="M12 18h.01"></path><path d="M8 18h.01"></path></svg>,
            X: () => <svg width="20" height="20" fill="none" stroke="currentColor" strokeWidth="2" viewBox="0 0 24 24"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>,
            Alert: () => <svg width="14" height="14" fill="none" stroke="currentColor" strokeWidth="2" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="8" x2="12" y2="12"></line><line x1="12" y1="16" x2="12.01" y2="16"></line></svg>
        };

        const LOGO_MONO = "https://multicast.com.ua/wp-content/uploads/2024/04/monobank-logo.png";
        const LOGO_NOVA = "https://novapay.credit/wp-content/uploads/2023/10/cropped-cropped-logo.png";
        
        const CATEGORIES = {
            income: ['–ü—Ä–æ–¥–∞–∂—ñ', '–ö–µ—à–±–µ–∫', '–Ü–Ω–≤–µ—Å—Ç–∏—Ü—ñ—ó', '–ü–æ–≤–µ—Ä–Ω–µ–Ω–Ω—è', '–Ü–Ω—à–µ'],
            expense: ['–ó–∞–∫—É–ø—ñ–≤–ª—è (COGS)', '–†–µ–∫–ª–∞–º–∞ (Ads)', '–î–æ—Å—Ç–∞–≤–∫–∞ (–õ–æ–≥—ñ—Å—Ç–∏–∫–∞)', '–ü–∞–∫—É–≤–∞–Ω–Ω—è', '–ö–æ–º—ñ—Å—ñ—ó', '–ü–æ–¥–∞—Ç–∫–∏', '–û—Ä–µ–Ω–¥–∞', '–ó–∞—Ä–ø–ª–∞—Ç–∞', '–°–µ—Ä–≤—ñ—Å–∏', '–Ü–Ω—à–µ']
        };

        const safeJSONParse = (key, fallback) => {
            try { return JSON.parse(localStorage.getItem(key)) || fallback; } 
            catch { return fallback; }
        };

        const fetchNewTransactions = () => {
            const rand = Math.random();
            if (rand > 0.7) {
                const isIncome = Math.random() > 0.5;
                return [{
                    id: Date.now(),
                    date: new Date().toISOString().split('T')[0],
                    amount: isIncome ? Math.floor(Math.random() * 2000) + 100 : -(Math.floor(Math.random() * 1000) + 50),
                    type: isIncome ? 'income' : 'expense',
                    category: null,
                    source: Math.random() > 0.5 ? 'monobank' : 'novapay',
                    description: isIncome ? '–ù–æ–≤–µ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è (Live)' : '–ê–≤—Ç–æ—Å–ø–∏—Å–∞–Ω–Ω—è (Live)',
                    status: 'pending'
                }];
            }
            return [];
        };

        // --- COMPONENTS ---

        // 1. Screensaver (Money Rain)
        const MoneyRain = ({ enabled }) => {
            const [coins, setCoins] = useState([]);
            useEffect(() => {
                if (enabled) {
                    const newCoins = Array.from({ length: 30 }).map((_, i) => ({
                        id: i,
                        left: Math.random() * 100 + '%',
                        delay: Math.random() * 5 + 's',
                        duration: (Math.random() * 3 + 2) + 's'
                    }));
                    setCoins(newCoins);
                }
            }, [enabled]);
            if (!enabled) return null;
            return (
                <div className="fixed inset-0 z-[9999] pointer-events-none overflow-hidden bg-black/40 backdrop-blur-sm flex items-center justify-center">
                    {coins.map(coin => (
                        <div key={coin.id} className="coin" style={{ left: coin.left, animationDelay: coin.delay, animationDuration: coin.duration }} />
                    ))}
                    <div className="text-white font-bold text-3xl animate-pulse drop-shadow-lg">–†—É—Ö–∞–π –º–∏—à–∫–æ—é, —â–æ–± –ø—Ä–∞—Ü—é–≤–∞—Ç–∏! üíº</div>
                </div>
            );
        };

        // 2. Calculator
        const Calculator = ({ onClose }) => {
            const [display, setDisplay] = useState('0');
            const [prev, setPrev] = useState(null);
            const [op, setOp] = useState(null);
            const [waiting, setWaiting] = useState(false);
            const input = (d) => { if (waiting) { setDisplay(String(d)); setWaiting(false); } else { setDisplay(display === '0' ? String(d) : display + d); } };
            const oper = (nextOp) => {
                const val = parseFloat(display);
                if (prev == null) setPrev(val);
                else if (op) { const res = op === '+' ? prev + val : op === '-' ? prev - val : op === '*' ? prev * val : prev / val; setPrev(res); setDisplay(String(res)); }
                setWaiting(true); setOp(nextOp);
            };
            const eq = () => { oper('='); setOp(null); setPrev(null); };
            const clr = () => { setDisplay('0'); setPrev(null); setOp(null); setWaiting(false); };
            const Btn = ({ v, cb, bg="bg-slate-50", c="text-slate-800" }) => <button onClick={cb} className={`${bg} ${c} p-4 rounded-xl font-bold text-lg hover:brightness-95 active:scale-95 transition-all shadow-sm`}>{v}</button>;

            return (
                <div className="fixed inset-0 z-[100] flex items-center justify-center bg-slate-900/50 backdrop-blur-sm">
                    <div className="bg-white rounded-2xl shadow-2xl w-80 overflow-hidden animate-fade-in border border-slate-200">
                        <div className="bg-slate-900 p-4 flex justify-between items-center text-white">
                            <span className="font-bold flex gap-2"><Icons.Calculator/> –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä</span>
                            <button onClick={onClose}><Icons.X/></button>
                        </div>
                        <div className="p-6 text-right bg-slate-50 text-3xl font-mono font-bold text-slate-800 border-b">{Number(display).toLocaleString('uk-UA', {maximumFractionDigits: 6})}</div>
                        <div className="p-4 grid grid-cols-4 gap-2 bg-white">
                            <Btn v="C" cb={clr} bg="bg-red-50" c="text-red-500"/><Btn v="/" cb={() => oper('/')} bg="bg-orange-50" c="text-orange-600"/><Btn v="*" cb={() => oper('*')} bg="bg-orange-50" c="text-orange-600"/><Btn v="-" cb={() => oper('-')} bg="bg-orange-50" c="text-orange-600"/>
                            {[7,8,9].map(n => <Btn key={n} v={n} cb={() => input(n)}/>)}<Btn v="+" cb={() => oper('+')} bg="bg-orange-50" c="text-orange-600"/>
                            {[4,5,6].map(n => <Btn key={n} v={n} cb={() => input(n)}/>)}<Btn v="=" cb={eq} bg="bg-latiao row-span-2 flex items-center justify-center" c="text-white"/>
                            {[1,2,3].map(n => <Btn key={n} v={n} cb={() => input(n)}/>)}<Btn v="0" cb={() => input(0)} bg="col-span-2 bg-slate-50"/><Btn v="." cb={() => input('.')}/>
                        </div>
                    </div>
                </div>
            );
        };

        // 3. P&L Report Component
        const PnLReport = ({ transactions }) => {
            const report = useMemo(() => {
                const incomeTx = transactions.filter(t => t.type === 'income');
                const expenseTx = transactions.filter(t => t.type === 'expense');
                const revenue = incomeTx.reduce((sum, t) => sum + t.amount, 0);
                const cogsTx = expenseTx.filter(t => t.category === '–ó–∞–∫—É–ø—ñ–≤–ª—è (COGS)');
                const cogs = Math.abs(cogsTx.reduce((sum, t) => sum + t.amount, 0));
                const grossProfit = revenue - cogs;
                const opexTx = expenseTx.filter(t => t.category !== '–ó–∞–∫—É–ø—ñ–≤–ª—è (COGS)');
                const opexTotal = Math.abs(opexTx.reduce((sum, t) => sum + t.amount, 0));
                const opexBreakdown = {};
                opexTx.forEach(t => { const cat = t.category || '–ù–µ –∫–ª–∞—Å–∏—Ñ—ñ–∫–æ–≤–∞–Ω–æ'; opexBreakdown[cat] = (opexBreakdown[cat] || 0) + Math.abs(t.amount); });
                const netProfit = grossProfit - opexTotal;
                return { revenue, cogs, grossProfit, grossMargin: revenue ? (grossProfit/revenue)*100 : 0, opexTotal, opexBreakdown, netProfit, netMargin: revenue ? (netProfit/revenue)*100 : 0 };
            }, [transactions]);

            const Row = ({ label, value, percent, bold, indent, color="text-slate-800" }) => (
                <div className={`flex justify-between items-center py-3 border-b border-slate-50 hover:bg-slate-50 px-4 ${bold ? 'font-bold bg-slate-50/50' : ''}`}>
                    <div className={`${indent ? 'pl-8 text-slate-500 text-sm' : 'text-slate-700'}`}>{label}</div>
                    <div className="flex items-center gap-8"><div className="text-xs text-slate-400 w-12 text-right">{percent ? `${percent.toFixed(1)}%` : '-'}</div><div className={`w-32 text-right ${color}`}>{value.toLocaleString()} ‚Ç¥</div></div>
                </div>
            );

            return (
                <div className="max-w-4xl animate-fade-in space-y-6">
                    <div className="bg-white rounded-2xl shadow-sm border border-slate-200 overflow-hidden">
                        <div className="bg-slate-50 p-4 flex justify-between text-xs font-bold text-slate-500 uppercase tracking-wider border-b border-slate-200"><div>–°—Ç–∞—Ç—Ç—è</div><div className="flex gap-8 pr-4"><div className="w-12 text-right">% –î–æ—Ö.</div><div className="w-32 text-right">–°—É–º–∞</div></div></div>
                        <div className="p-2">
                            <Row label="–í–∏—Ä—É—á–∫–∞" value={report.revenue} percent={100} bold color="text-emerald-600" />
                            <Row label="–°–æ–±—ñ–≤–∞—Ä—Ç—ñ—Å—Ç—å (COGS)" value={-report.cogs} percent={(report.cogs/report.revenue)*100} indent color="text-red-500" />
                            <Row label="–í–∞–ª–æ–≤–∏–π –ø—Ä–∏–±—É—Ç–æ–∫" value={report.grossProfit} percent={report.grossMargin} bold color="text-slate-900" />
                            <div className="my-4"><div className="px-4 text-xs font-bold text-slate-400 uppercase mb-2">–û–ø–µ—Ä–∞—Ü—ñ–π–Ω—ñ –≤–∏—Ç—Ä–∞—Ç–∏</div>{Object.entries(report.opexBreakdown).map(([cat, val]) => <Row key={cat} label={cat} value={-val} percent={(val/report.revenue)*100} indent />)}<Row label="–í—Å—å–æ–≥–æ –≤–∏—Ç—Ä–∞—Ç" value={-report.opexTotal} percent={(report.opexTotal/report.revenue)*100} bold indent /></div>
                            <div className="bg-slate-900 text-white rounded-xl mx-2 mt-4 p-4 flex justify-between items-center shadow-lg"><div><div className="text-sm text-slate-400">–ß–∏—Å—Ç–∏–π –ø—Ä–∏–±—É—Ç–æ–∫</div><div className="text-xs text-emerald-400">Net Margin: {report.netMargin.toFixed(1)}%</div></div><div className="text-3xl font-bold">{report.netProfit.toLocaleString()} ‚Ç¥</div></div>
                        </div>
                    </div>
                </div>
            );
        };

        // 4. Main App
        const App = () => {
            const [activeTab, setActiveTab] = useState('–î–∞—à–±–æ—Ä–¥');
            const [transactions, setTransactions] = useState(() => safeJSONParse('latiao_v3_tx', []));
            const [settings, setSettings] = useState(() => safeJSONParse('latiao_settings', { screensaver: true }));
            const [connections, setConnections] = useState(() => safeJSONParse('latiao_conn', { mono: false }));
            const [lastUpdated, setLastUpdated] = useState(new Date());
            const [showCalc, setShowCalc] = useState(false);
            const [isIdle, setIsIdle] = useState(false);
            const idleTimerRef = useRef(null);

            // Filters
            const [search, setSearch] = useState('');
            const [filterType, setFilterType] = useState('all');

            useEffect(() => localStorage.setItem('latiao_v3_tx', JSON.stringify(transactions)), [transactions]);
            useEffect(() => localStorage.setItem('latiao_settings', JSON.stringify(settings)), [settings]);
            useEffect(() => localStorage.setItem('latiao_conn', JSON.stringify(connections)), [connections]);

            // Auto-update Loop
            useEffect(() => {
                const interval = setInterval(() => {
                    const newTx = fetchNewTransactions();
                    if (newTx.length > 0) setTransactions(prev => [...newTx, ...prev]);
                    setLastUpdated(new Date());
                }, 60000);
                return () => clearInterval(interval);
            }, []);

            // Idle Timer Logic
            const resetIdle = () => {
                setIsIdle(false);
                if (idleTimerRef.current) clearTimeout(idleTimerRef.current);
                if (settings.screensaver) idleTimerRef.current = setTimeout(() => setIsIdle(true), 60000);
            };
            useEffect(() => {
                window.addEventListener('mousemove', resetIdle); window.addEventListener('keydown', resetIdle); window.addEventListener('click', resetIdle);
                resetIdle();
                return () => { window.removeEventListener('mousemove', resetIdle); window.removeEventListener('keydown', resetIdle); window.removeEventListener('click', resetIdle); };
            }, [settings.screensaver]);

            const filteredTx = useMemo(() => transactions.filter(t => {
                const s = search.toLowerCase();
                const mSearch = t.description?.toLowerCase().includes(s) || t.category?.toLowerCase().includes(s);
                const mType = filterType === 'all' || t.type === filterType;
                return mSearch && mType;
            }).sort((a,b) => b.id - a.id), [transactions, search, filterType]);

            const stats = useMemo(() => {
                const inc = transactions.filter(t => t.type === 'income').reduce((s, t) => s + t.amount, 0);
                const exp = Math.abs(transactions.filter(t => t.type === 'expense').reduce((s, t) => s + t.amount, 0));
                return { revenue: inc, expenses: exp, profit: inc - exp };
            }, [transactions]);

            const KPI = ({ title, value, trend }) => (
                <div className="bg-white p-6 rounded-2xl shadow-sm border border-slate-100 hover:shadow-md transition-all">
                    <div className="flex justify-between items-start mb-2"><div className="text-slate-500 text-sm font-medium">{title}</div><span className={`text-xs px-2 py-1 rounded-full ${trend==='up'?'bg-green-50 text-green-600':'bg-red-50 text-red-600'}`}>{trend==='up'?'‚ñ≤ +12%':'‚ñº -5%'}</span></div>
                    <div className="text-3xl font-bold text-slate-800">{value}</div>
                </div>
            );

            return (
                <div className="flex min-h-screen">
                    <MoneyRain enabled={isIdle && settings.screensaver} />
                    
                    <div className="w-64 bg-white h-screen fixed left-0 top-0 border-r border-slate-200 flex flex-col z-20">
                        <div className="p-8 flex items-center gap-3">
                            <div className="w-10 h-10 bg-latiao rounded-xl flex items-center justify-center text-white font-bold text-xl shadow-lg shadow-orange-200">L</div>
                            <div><h1 className="text-lg font-bold text-slate-800 leading-tight">Latiao</h1><div className="text-xs text-slate-400 font-medium tracking-wide">FINANCE PRO</div></div>
                        </div>
                        <nav className="flex-1 px-4 space-y-1">
                            {['–î–∞—à–±–æ—Ä–¥', '–û–ø–µ—Ä–∞—Ü—ñ—ó', 'P&L –ó–≤—ñ—Ç', 'Cash Flow', '–ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è'].map(id => (
                                <div key={id} onClick={() => setActiveTab(id)} className={`flex items-center gap-3 p-3 rounded-xl cursor-pointer transition-all ${activeTab===id ? 'bg-orange-50 text-latiao font-semibold' : 'text-slate-500 hover:bg-slate-50'}`}>
                                    {id==='–î–∞—à–±–æ—Ä–¥' && <Icons.Dashboard/>}{id==='–û–ø–µ—Ä–∞—Ü—ñ—ó' && <Icons.List/>}{id==='P&L –ó–≤—ñ—Ç' && <Icons.PieChart/>}{id==='Cash Flow' && <Icons.ArrowUpRight/>}{id==='–ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è' && <Icons.Settings/>}
                                    {id}
                                </div>
                            ))}
                        </nav>
                    </div>

                    <main className="flex-1 ml-64 p-10 overflow-y-auto h-screen bg-[#F8FAFC]">
                        <header className="flex justify-between items-center mb-8 animate-fade-in">
                            <div>
                                <h2 className="text-3xl font-bold text-slate-800">{activeTab}</h2>
                                <div className="flex items-center gap-2 mt-1"><span className="w-2 h-2 rounded-full bg-emerald-500 animate-pulse"></span><p className="text-slate-400 text-xs font-medium">–û–Ω–æ–≤–ª–µ–Ω–æ: {lastUpdated.toLocaleTimeString()}</p></div>
                            </div>
                            <div className="flex items-center gap-4 bg-white p-2 pr-4 rounded-full border border-slate-200 shadow-sm"><div className="w-10 h-10 bg-slate-900 rounded-full flex items-center justify-center text-white font-bold">R</div><div className="text-sm"><div className="font-bold text-slate-800">–†—É—Å–ª–∞–Ω</div></div></div>
                        </header>

                        {activeTab === '–î–∞—à–±–æ—Ä–¥' && (
                            <div className="space-y-6 animate-fade-in">
                                <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
                                    <KPI title="–í–∏—Ä—É—á–∫–∞" value={`${stats.revenue.toLocaleString()} ‚Ç¥`} trend="up" />
                                    <KPI title="–í–∏—Ç—Ä–∞—Ç–∏" value={`${stats.expenses.toLocaleString()} ‚Ç¥`} trend="down" />
                                    <KPI title="–ß–∏—Å—Ç–∏–π –ø—Ä–∏–±—É—Ç–æ–∫" value={`${stats.profit.toLocaleString()} ‚Ç¥`} trend={stats.profit > 0 ? 'up' : 'down'} />
                                </div>
                                <div className="bg-white p-12 rounded-2xl shadow-sm border border-slate-200 text-center text-slate-400">–ì—Ä–∞—Ñ—ñ–∫–∏ —Ñ–æ—Ä–º—É—é—Ç—å—Å—è...</div>
                            </div>
                        )}

                        {activeTab === '–û–ø–µ—Ä–∞—Ü—ñ—ó' && (
                            <div className="animate-fade-in space-y-6">
                                <div className="bg-white p-4 rounded-xl shadow-sm border border-slate-200 flex gap-4">
                                    <div className="relative flex-1"><div className="absolute top-3 left-3 text-slate-400"><Icons.Search /></div><input type="text" placeholder="–ü–æ—à—É–∫..." value={search} onChange={e => setSearch(e.target.value)} className="w-full pl-10 pr-4 py-2 border border-slate-200 rounded-lg focus:outline-none focus:border-orange-500" /></div>
                                    <select value={filterType} onChange={e => setFilterType(e.target.value)} className="border border-slate-200 rounded-lg px-4 py-2 bg-slate-50"><option value="all">–í—Å—ñ —Ç–∏–ø–∏</option><option value="income">–î–æ—Ö–æ–¥–∏</option><option value="expense">–í–∏—Ç—Ä–∞—Ç–∏</option></select>
                                </div>
                                <div className="bg-white rounded-2xl shadow-sm border border-slate-200 overflow-hidden">
                                    <table className="w-full">
                                        <thead className="bg-slate-50 border-b border-slate-200"><tr><th className="p-5 text-left text-xs font-bold text-slate-500 uppercase">–î–∞—Ç–∞</th><th className="p-5 text-left text-xs font-bold text-slate-500 uppercase">–û–ø–∏—Å</th><th className="p-5 text-left text-xs font-bold text-slate-500 uppercase">–°—Ç–∞—Ç—Ç—è</th><th className="p-5 text-right text-xs font-bold text-slate-500 uppercase">–°—É–º–∞</th></tr></thead>
                                        <tbody className="divide-y divide-slate-100">
                                            {filteredTx.map(t => (
                                                <tr key={t.id} className="hover:bg-orange-50/30 transition-colors">
                                                    <td className="p-5 text-sm text-slate-500 font-mono">{t.date}</td>
                                                    <td className="p-5"><div className="font-medium text-slate-700">{t.description}</div><div className="text-xs text-slate-400 flex items-center gap-1 mt-1"><img src={t.source === 'monobank' ? LOGO_MONO : LOGO_NOVA} className="w-3 h-3 grayscale opacity-60" /> {t.source}</div></td>
                                                    <td className="p-5">{t.category ? <span className="px-2 py-1 bg-slate-100 rounded text-xs text-slate-600 border border-slate-200">{t.category}</span> : <select onChange={(e) => { const newT = [...transactions]; newT.find(x=>x.id===t.id).category=e.target.value; setTransactions(newT); }} className="text-xs border border-orange-200 bg-orange-50 text-orange-600 rounded px-2 py-1"><option>+ –ö–ª–∞—Å–∏—Ñ—ñ–∫—É–≤–∞—Ç–∏</option>{CATEGORIES[t.type].map(c=><option key={c} value={c}>{c}</option>)}</select>}</td>
                                                    <td className={`p-5 text-right font-bold text-sm ${t.type === 'income' ? 'text-emerald-600' : 'text-slate-800'}`}>{t.amount.toLocaleString()} ‚Ç¥</td>
                                                </tr>
                                            ))}
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        )}

                        {activeTab === 'P&L –ó–≤—ñ—Ç' && <PnLReport transactions={transactions} />}

                        {activeTab === '–ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è' && (
                            <div className="max-w-2xl animate-fade-in space-y-6">
                                <div className="bg-white rounded-2xl p-6 border border-slate-200 shadow-sm flex items-center justify-between">
                                    <div><div className="font-bold text-slate-800">–†–µ–∂–∏–º –ø–∞–¥–∞—é—á–∏—Ö –º–æ–Ω–µ—Ç</div><div className="text-xs text-slate-500">–ó–∞—Å—Ç–∞–≤–∫–∞ –ø—Ä–∏ –±–µ–∑–¥—ñ—è–ª—å–Ω–æ—Å—Ç—ñ</div></div>
                                    <input type="checkbox" checked={settings.screensaver} onChange={e => setSettings({...settings, screensaver: e.target.checked})} className="w-6 h-6 accent-[#FF5722]" />
                                </div>
                                <div className="bg-white rounded-2xl p-6 border border-slate-200 shadow-sm">
                                    <h3 className="font-bold mb-4 flex items-center gap-2"><img src={LOGO_MONO} className="w-6"/> Monobank API</h3>
                                    {!connections.mono ? <div className="space-y-3"><input type="password" placeholder="X-Token" className="w-full border p-3 rounded-xl"/><button onClick={()=>setConnections({mono:true})} className="w-full bg-slate-900 text-white p-3 rounded-xl font-bold">–ü—ñ–¥–∫–ª—é—á–∏—Ç–∏</button></div> : <div className="text-green-600 font-bold">‚úì –ü—ñ–¥–∫–ª—é—á–µ–Ω–æ</div>}
                                </div>
                            </div>
                        )}

                        {(activeTab === 'Cash Flow') && <div className="text-center py-20 text-slate-400">–†–æ–∑–¥—ñ–ª —É —Ä–æ–∑—Ä–æ–±—Ü—ñ...</div>}
                    </main>

                    <button onClick={() => setShowCalc(true)} className="fixed bottom-8 right-8 bg-slate-900 text-white p-4 rounded-full shadow-xl hover:bg-latiao hover:scale-110 transition-all z-50"><Icons.Calculator /></button>
                    {showCalc && <Calculator onClose={() => setShowCalc(false)} />}
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
