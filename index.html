<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Latiao Finance System</title>
    
    <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        latiao: {
                            50: '#fff7ed',
                            100: '#ffedd5',
                            500: '#FF5722', // Brand Color
                            600: '#ea580c',
                            900: '#7c2d12',
                        },
                        mono: '#1e1e24',
                        nova: '#d92828'
                    },
                    fontFamily: { sans: ['Inter', 'sans-serif'] }
                }
            }
        }
    </script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #F1F5F9; -webkit-tap-highlight-color: transparent; }
        .glass-panel { background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(8px); border: 1px solid rgba(255,255,255,0.5); }
        .hide-scrollbar::-webkit-scrollbar { display: none; }
        .hide-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        .animate-enter { animation: enter 0.3s ease-out; }
        @keyframes enter { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>

<div id="root"></div>

<script type="text/babel" data-type="module">
    // --- FIREBASE IMPORTS ---
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getFirestore, collection, addDoc, onSnapshot, query, orderBy, deleteDoc, doc, updateDoc, writeBatch } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
    import { getAuth, signInWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

    // --- CONFIG ---
    const firebaseConfig = {
      apiKey: "AIzaSyDIk302oYXye-r4hRE-EB16N6K3T31g1uk",
      authDomain: "latiao-finance.firebaseapp.com",
      projectId: "latiao-finance",
      storageBucket: "latiao-finance.firebasestorage.app",
      messagingSenderId: "858773999156",
      appId: "1:858773999156:web:fe8f4907314f83c9a88461"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const auth = getAuth(app);

    const { useState, useEffect, useMemo } = React;

    // --- ICONS COMPONENT ---
    const Icon = ({ name, size = 20, className }) => {
        useEffect(() => { lucide.createIcons(); }, [name]);
        return <i data-lucide={name} width={size} height={size} className={className}></i>;
    };

    // --- CONSTANTS & DATA MODELS ---
    const ACCOUNTS = [
        { id: 'mono', name: 'Monobank –§–û–ü', type: 'bank', color: 'bg-mono text-white' },
        { id: 'nova', name: 'NovaPay', type: 'bank', color: 'bg-nova text-white' },
        { id: 'cash', name: '–ì–æ—Ç—ñ–≤–∫–∞', type: 'cash', color: 'bg-green-600 text-white' }
    ];

    const CATEGORIES = {
        income: ['–ü—Ä–æ–¥–∞–∂—ñ', '–ü–æ–≤–µ—Ä–Ω–µ–Ω–Ω—è –ø–æ—Å—Ç.', '–ö–µ—à–±–µ–∫', '–Ü–Ω—à–µ'],
        expense: ['–ó–∞–∫—É–ø—ñ–≤–ª—è (COGS)', '–†–µ–∫–ª–∞–º–∞', '–õ–æ–≥—ñ—Å—Ç–∏–∫–∞', '–ü–∞–∫—É–≤–∞–Ω–Ω—è', '–ó–∞—Ä–ø–ª–∞—Ç–∞', '–ö–æ–º—ñ—Å—ñ—ó', '–û—Ä–µ–Ω–¥–∞', '–ü–æ–¥–∞—Ç–∫–∏', '–û—Ñ—ñ—Å', '–Ü–Ω—à–µ']
    };

    const SMART_RULES = [
        { keyword: 'Nova Poshta', cat: '–õ–æ–≥—ñ—Å—Ç–∏–∫–∞' },
        { keyword: 'NovaPay', cat: '–ö–æ–º—ñ—Å—ñ—ó' },
        { keyword: 'Meta', cat: '–†–µ–∫–ª–∞–º–∞' },
        { keyword: 'Facebook', cat: '–†–µ–∫–ª–∞–º–∞' },
        { keyword: 'Prom', cat: '–†–µ–∫–ª–∞–º–∞' },
        { keyword: 'Gepard', cat: '–õ–æ–≥—ñ—Å—Ç–∏–∫–∞' }
    ];

    // --- MAIN APP COMPONENT ---
    const App = () => {
        const [user, setUser] = useState(null);
        const [view, setView] = useState('auth'); // auth, dashboard, ops, pnl, cashflow, dividends, settings
        const [transactions, setTransactions] = useState([]);
        const [loading, setLoading] = useState(true);

        // Auth State
        const [email, setEmail] = useState('');
        const [password, setPassword] = useState('');
        const [authError, setAuthError] = useState('');

        // Modals
        const [modal, setModal] = useState(null); // 'add', 'dividend'
        
        // Settings State
        const [keys, setKeys] = useState({ mono: '', nova: '' });

        // --- AUTH & DATA LISTENER ---
        useEffect(() => {
            const unsubAuth = onAuthStateChanged(auth, (u) => {
                setUser(u);
                if (u) {
                    setView('dashboard');
                    const q = query(collection(db, "transactions"), orderBy("createdAt", "desc"));
                    const unsubDb = onSnapshot(q, (snapshot) => {
                        setTransactions(snapshot.docs.map(d => ({ id: d.id, ...d.data() })));
                        setLoading(false);
                    });
                    return () => unsubDb();
                } else {
                    setView('auth');
                    setLoading(false);
                }
            });
            return () => unsubAuth();
        }, []);

        // --- CALCULATIONS ENGINE (THE BRAIN) ---
        const financials = useMemo(() => {
            // 1. P&L Logic (Dividends are NOT expenses)
            const incomeTx = transactions.filter(t => t.type === 'income' && !t.isDividend);
            const expenseTx = transactions.filter(t => t.type === 'expense' && !t.isDividend);
            
            const revenue = incomeTx.reduce((sum, t) => sum + t.amount, 0);
            const cogs = expenseTx.filter(t => t.cat === '–ó–∞–∫—É–ø—ñ–≤–ª—è (COGS)').reduce((sum, t) => sum + t.amount, 0);
            const grossProfit = revenue - cogs;
            
            const opexTx = expenseTx.filter(t => t.cat !== '–ó–∞–∫—É–ø—ñ–≤–ª—è (COGS)');
            const opex = opexTx.reduce((sum, t) => sum + t.amount, 0);
            const netProfit = grossProfit - opex;

            // 2. Cash Flow Logic (Includes Dividends)
            const dividends = transactions.filter(t => t.isDividend).reduce((sum, t) => sum + t.amount, 0);
            const totalInflow = transactions.filter(t => t.type === 'income').reduce((sum, t) => sum + t.amount, 0);
            const totalOutflow = transactions.filter(t => t.type === 'expense').reduce((sum, t) => sum + t.amount, 0); // Includes dividends if marked as expense type in DB
            
            // Calculate Balances
            const balances = { mono: 0, nova: 0, cash: 0, total: 0 };
            transactions.forEach(t => {
                const val = t.type === 'income' ? t.amount : -t.amount;
                const accKey = ACCOUNTS.find(a => a.name === t.source)?.id || 'cash';
                if(balances[accKey] !== undefined) balances[accKey] += val;
                balances.total += val;
            });

            // 3. Business Health
            const grossMargin = revenue ? ((grossProfit / revenue) * 100).toFixed(1) : 0;
            const netMargin = revenue ? ((netProfit / revenue) * 100).toFixed(1) : 0;
            
            // Runway (Average daily burn over last 30 days - simulated)
            const dailyBurn = (opex + cogs) / 30 || 1;
            const runwayDays = (balances.total / dailyBurn).toFixed(0);

            return { revenue, cogs, grossProfit, opex, netProfit, dividends, balances, grossMargin, netMargin, runwayDays, opexTx };
        }, [transactions]);

        // --- ACTIONS ---
        const handleLogin = async (e) => {
            e.preventDefault();
            try {
                await signInWithEmailAndPassword(auth, email, password);
            } catch (err) {
                setAuthError("–ù–µ–≤—ñ—Ä–Ω—ñ –¥–∞–Ω—ñ. –°–ø—Ä–æ–±—É–π—Ç–µ —â–µ —Ä–∞–∑.");
            }
        };

        const handleAddTransaction = async (formData) => {
            // Smart Rules Apply
            let finalCat = formData.cat;
            let status = 'confirmed';
            
            if (formData.cat === '–Ü–Ω—à–µ' && !formData.isDividend) {
                const rule = SMART_RULES.find(r => formData.desc.toLowerCase().includes(r.keyword.toLowerCase()));
                if (rule) finalCat = rule.cat;
                else status = 'needs_review'; // If no rule and category is 'Other'
            }

            await addDoc(collection(db, "transactions"), {
                ...formData,
                cat: finalCat,
                status: status,
                createdAt: Date.now(),
                date: new Date().toISOString().split('T')[0] // YYYY-MM-DD
            });
            setModal(null);
        };

        const deleteTx = async (id) => {
            if(confirm("–í–∏–¥–∞–ª–∏—Ç–∏ —Ü—é –æ–ø–µ—Ä–∞—Ü—ñ—é?")) await deleteDoc(doc(db, "transactions", id));
        };

        // --- UI COMPONENTS ---

        // 1. LOGIN SCREEN
        if (view === 'auth') {
            return (
                <div className="min-h-screen bg-[#111] flex flex-col items-center justify-center p-6 relative overflow-hidden text-white">
                    <div className="absolute top-[-20%] left-[-20%] w-[500px] h-[500px] bg-latiao-500 rounded-full opacity-20 blur-[100px]"></div>
                    <div className="z-10 w-full max-w-sm bg-white/10 backdrop-blur-xl border border-white/10 p-8 rounded-3xl shadow-2xl animate-enter">
                        <div className="flex justify-center mb-6">
                            <div className="w-16 h-16 bg-latiao-500 rounded-2xl flex items-center justify-center text-3xl font-bold shadow-lg shadow-orange-500/20">L</div>
                        </div>
                        <h1 className="text-2xl font-bold text-center mb-2">Latiao Finance</h1>
                        <p className="text-center text-gray-400 text-xs uppercase tracking-widest mb-8">System Access</p>
                        
                        <form onSubmit={handleLogin} className="space-y-4">
                            <div>
                                <label className="text-xs font-bold text-gray-500 ml-1">EMAIL</label>
                                <input type="email" value={email} onChange={e=>setEmail(e.target.value)} className="w-full bg-white/5 border border-white/10 rounded-xl p-3 text-white focus:border-latiao-500 outline-none transition-colors" placeholder="admin@latiao.com"/>
                            </div>
                            <div>
                                <label className="text-xs font-bold text-gray-500 ml-1">PASSWORD</label>
                                <input type="password" value={password} onChange={e=>setPassword(e.target.value)} className="w-full bg-white/5 border border-white/10 rounded-xl p-3 text-white focus:border-latiao-500 outline-none transition-colors" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"/>
                            </div>
                            {authError && <div className="text-red-400 text-xs text-center">{authError}</div>}
                            <button type="submit" className="w-full bg-latiao-500 hover:bg-latiao-600 text-white font-bold py-4 rounded-xl shadow-lg shadow-orange-900/50 transition-transform active:scale-95">–£–≤—ñ–π—Ç–∏</button>
                        </form>
                    </div>
                </div>
            );
        }

        // 2. DASHBOARD VIEW
        const Dashboard = () => (
            <div className="space-y-6 animate-enter pb-24">
                {/* Header */}
                <div className="flex justify-between items-center">
                    <div>
                        <h1 className="text-2xl font-bold text-gray-800">–û–≥–ª—è–¥</h1>
                        <p className="text-xs text-gray-400">–°—å–æ–≥–æ–¥–Ω—ñ: {new Date().toLocaleDateString('uk-UA')}</p>
                    </div>
                    <button onClick={() => setModal('add')} className="bg-latiao-500 text-white p-3 rounded-full shadow-lg shadow-orange-200 active:scale-90 transition-transform">
                        <Icon name="plus" />
                    </button>
                </div>

                {/* Alerts Section */}
                {(financials.balances.total < 0 || financials.runwayDays < 15) && (
                     <div className="bg-red-50 border-l-4 border-red-500 p-4 rounded-r-xl flex items-start gap-3">
                        <Icon name="alert-triangle" className="text-red-500 shrink-0" />
                        <div>
                            <h3 className="font-bold text-red-800 text-sm">–£–≤–∞–≥–∞: –§—ñ–Ω–∞–Ω—Å–æ–≤–∞ –Ω–µ–±–µ–∑–ø–µ–∫–∞</h3>
                            <p className="text-xs text-red-600">
                                {financials.balances.total < 0 ? '–ó–∞–≥–∞–ª—å–Ω–∏–π –±–∞–ª–∞–Ω—Å –º—ñ–Ω—É—Å–æ–≤–∏–π!' : '–ö–µ—à-—Ä–µ–∑–µ—Ä–≤ –º–µ–Ω—à–µ 15 –¥–Ω—ñ–≤!'}
                            </p>
                        </div>
                    </div>
                )}

                {/* KPI Cards */}
                <div className="grid grid-cols-2 gap-3">
                    <div className="bg-white p-4 rounded-2xl shadow-sm border border-slate-100">
                        <div className="text-xs text-gray-400 font-bold uppercase mb-1">–ß–∏—Å—Ç–∏–π –ø—Ä–∏–±—É—Ç–æ–∫</div>
                        <div className={`text-xl font-bold ${financials.netProfit>=0 ? 'text-emerald-600':'text-red-600'}`}>
                            {financials.netProfit.toLocaleString()} ‚Ç¥
                        </div>
                        <div className="text-[10px] text-gray-400 mt-1">Margin: {financials.netMargin}%</div>
                    </div>
                    <div className="bg-white p-4 rounded-2xl shadow-sm border border-slate-100">
                        <div className="text-xs text-gray-400 font-bold uppercase mb-1">Runway (–ó–∞–ø–∞—Å)</div>
                        <div className="text-xl font-bold text-latiao-500">{financials.runwayDays} –¥–Ω—ñ–≤</div>
                        <div className="text-[10px] text-gray-400 mt-1">–î–æ –∫–∞—Å–æ–≤–æ–≥–æ —Ä–æ–∑—Ä–∏–≤—É</div>
                    </div>
                </div>

                {/* Balances */}
                <div className="bg-slate-900 text-white p-6 rounded-3xl shadow-xl relative overflow-hidden">
                    <div className="relative z-10">
                        <div className="text-gray-400 text-xs font-bold uppercase mb-1">–ì—Ä–æ—à—ñ –Ω–∞ —Ä–∞—Ö—É–Ω–∫–∞—Ö</div>
                        <div className="text-3xl font-bold mb-6">{financials.balances.total.toLocaleString()} ‚Ç¥</div>
                        <div className="space-y-3">
                            {ACCOUNTS.map(acc => (
                                <div key={acc.id} className="flex justify-between items-center text-sm">
                                    <div className="flex items-center gap-2">
                                        <div className={`w-2 h-2 rounded-full ${acc.id==='mono'?'bg-white':(acc.id==='nova'?'bg-red-500':'bg-green-500')}`}></div>
                                        <span className="text-gray-300">{acc.name}</span>
                                    </div>
                                    <span className="font-mono">{financials.balances[acc.id].toLocaleString()}</span>
                                </div>
                            ))}
                        </div>
                    </div>
                </div>

                {/* Recent Transactions */}
                <div>
                    <div className="flex justify-between items-center mb-3 px-1">
                        <h3 className="font-bold text-gray-700">–û—Å—Ç–∞–Ω–Ω—ñ –æ–ø–µ—Ä–∞—Ü—ñ—ó</h3>
                        <button onClick={()=>setView('ops')} className="text-xs text-latiao-500 font-bold">–í—Å—ñ</button>
                    </div>
                    <div className="bg-white rounded-2xl border border-slate-100 shadow-sm overflow-hidden">
                        {transactions.slice(0, 5).map(t => (
                            <div key={t.id} className="p-4 border-b border-slate-50 flex justify-between items-center last:border-0">
                                <div className="flex gap-3 items-center">
                                    <div className={`p-2 rounded-full ${t.isDividend ? 'bg-purple-100 text-purple-600' : (t.type==='income'?'bg-emerald-100 text-emerald-600':'bg-red-50 text-red-500')}`}>
                                        <Icon name={t.isDividend ? "gem" : (t.type==='income'?"arrow-down-left":"arrow-up-right")} size={16}/>
                                    </div>
                                    <div>
                                        <div className="font-bold text-sm text-gray-800">{t.description}</div>
                                        <div className="text-[10px] text-gray-400 flex gap-2">
                                            <span className="bg-slate-100 px-1 rounded">{t.cat}</span>
                                            {t.source}
                                        </div>
                                    </div>
                                </div>
                                <div className={`font-bold text-sm ${t.type==='income'?'text-emerald-600':'text-gray-900'}`}>
                                    {t.type==='income'?'+':'-'}{t.amount.toLocaleString()}
                                </div>
                            </div>
                        ))}
                    </div>
                </div>
            </div>
        );

        // 3. P&L VIEW
        const PnLView = () => (
             <div className="bg-white min-h-screen p-4 pb-24 animate-enter">
                <h2 className="text-xl font-bold mb-6">P&L –ó–≤—ñ—Ç</h2>
                <div className="space-y-4">
                    {/* Revenue Block */}
                    <div className="p-4 border border-emerald-100 bg-emerald-50 rounded-xl">
                        <div className="text-xs text-emerald-600 font-bold uppercase">–í–∏—Ä—É—á–∫–∞ (Revenue)</div>
                        <div className="text-2xl font-bold text-emerald-700">+{financials.revenue.toLocaleString()} ‚Ç¥</div>
                    </div>
                    
                    {/* COGS */}
                    <div className="flex justify-between items-center px-2 text-sm text-gray-500">
                        <span>(-) –°–æ–±—ñ–≤–∞—Ä—Ç—ñ—Å—Ç—å (COGS)</span>
                        <span>{financials.cogs.toLocaleString()}</span>
                    </div>

                    {/* Gross Profit */}
                    <div className="p-3 bg-blue-50 border-l-4 border-blue-500 rounded flex justify-between items-center font-bold text-blue-900">
                        <span>–í–∞–ª–æ–≤–∏–π –ø—Ä–∏–±—É—Ç–æ–∫</span>
                        <span>{financials.grossProfit.toLocaleString()}</span>
                    </div>
                    <div className="text-right text-xs text-blue-400 mb-4">Margin: {financials.grossMargin}%</div>

                    {/* OpEx Breakdown */}
                    <div>
                        <div className="text-xs font-bold text-gray-400 uppercase mb-2">–û–ø–µ—Ä–∞—Ü—ñ–π–Ω—ñ –≤–∏—Ç—Ä–∞—Ç–∏</div>
                        <div className="space-y-2">
                            {Object.entries(financials.opexTx.reduce((acc, t) => {
                                acc[t.cat] = (acc[t.cat] || 0) + t.amount; return acc;
                            }, {})).sort((a,b)=>b[1]-a[1]).map(([cat, val]) => (
                                <div key={cat} className="flex justify-between text-sm py-1 border-b border-dashed border-gray-100">
                                    <span className="text-gray-600">{cat}</span>
                                    <span className="font-medium">{val.toLocaleString()}</span>
                                </div>
                            ))}
                        </div>
                    </div>

                    {/* Net Profit */}
                    <div className="mt-6 pt-4 border-t-2 border-gray-900 flex justify-between items-center">
                        <span className="font-bold text-lg">–ß–∏—Å—Ç–∏–π –ø—Ä–∏–±—É—Ç–æ–∫</span>
                        <span className={`text-2xl font-bold ${financials.netProfit>=0?'text-emerald-600':'text-red-600'}`}>
                            {financials.netProfit.toLocaleString()}
                        </span>
                    </div>
                    <div className="text-center text-xs text-gray-400 mt-8">
                        * –î–∏–≤—ñ–¥–µ–Ω–¥–∏ –Ω–µ –≤–∫–ª—é—á–µ–Ω—ñ —É –≤–∏—Ç—Ä–∞—Ç–∏ P&L. –î–∏–≤. Cash Flow.
                    </div>
                </div>
            </div>
        );

        // 4. DIVIDENDS VIEW
        const DividendsView = () => (
             <div className="p-4 pb-24 animate-enter">
                <div className="bg-gradient-to-br from-slate-800 to-slate-900 text-white p-6 rounded-3xl shadow-xl mb-6">
                    <h2 className="text-xl font-bold mb-1">–î–∏–≤—ñ–¥–µ–Ω–¥–∏</h2>
                    <p className="text-xs text-gray-400 mb-6">–†–æ–∑–ø–æ–¥—ñ–ª –ø—Ä–∏–±—É—Ç–∫—É –≤–ª–∞—Å–Ω–∏–∫—É</p>
                    
                    <div className="grid grid-cols-2 gap-4 mb-6">
                        <div className="bg-white/10 p-3 rounded-xl backdrop-blur-md">
                            <div className="text-[10px] text-gray-300 uppercase">–î–æ—Å—Ç—É–ø–Ω–æ (Net Profit)</div>
                            <div className="text-lg font-bold text-emerald-400">{financials.netProfit.toLocaleString()} ‚Ç¥</div>
                        </div>
                         <div className="bg-white/10 p-3 rounded-xl backdrop-blur-md">
                            <div className="text-[10px] text-gray-300 uppercase">–í–∂–µ –≤–∏–≤–µ–¥–µ–Ω–æ</div>
                            <div className="text-lg font-bold text-orange-400">{financials.dividends.toLocaleString()} ‚Ç¥</div>
                        </div>
                    </div>

                    <button onClick={() => setModal('dividend')} className="w-full bg-white text-slate-900 font-bold py-3 rounded-xl shadow-lg hover:bg-gray-100 transition-colors">
                        –í–∏–ø–ª–∞—Ç–∏—Ç–∏ –¥–∏–≤—ñ–¥–µ–Ω–¥–∏
                    </button>
                </div>

                <h3 className="font-bold text-gray-700 mb-3 px-1">–Ü—Å—Ç–æ—Ä—ñ—è –≤–∏–ø–ª–∞—Ç</h3>
                <div className="bg-white rounded-2xl border border-slate-200 shadow-sm">
                    {transactions.filter(t => t.isDividend).length === 0 ? (
                        <div className="p-8 text-center text-gray-400 text-sm">–í–∏–ø–ª–∞—Ç —â–µ –Ω–µ –±—É–ª–æ</div>
                    ) : transactions.filter(t => t.isDividend).map(t => (
                        <div key={t.id} className="p-4 border-b last:border-0 flex justify-between items-center">
                            <div>
                                <div className="font-bold text-sm">{t.description}</div>
                                <div className="text-xs text-gray-400">{t.date} | {t.source}</div>
                            </div>
                            <div className="font-bold text-gray-900">-{t.amount.toLocaleString()}</div>
                        </div>
                    ))}
                </div>
            </div>
        );

        // 5. SETTINGS / INTEGRATIONS
        const SettingsView = () => (
            <div className="p-4 pb-24 animate-enter space-y-6">
                <h2 className="text-2xl font-bold">–ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è</h2>
                
                {/* Integrations */}
                <div className="bg-white p-6 rounded-2xl shadow-sm border border-slate-100">
                    <h3 className="font-bold mb-4 flex items-center gap-2 text-sm uppercase text-gray-500">
                        <Icon name="link" size={16}/> –Ü–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—ó
                    </h3>
                    
                    <div className="space-y-4">
                        {/* Mono */}
                        <div className="p-3 bg-gray-50 rounded-xl border border-gray-100">
                            <div className="flex justify-between items-center mb-2">
                                <span className="font-bold flex items-center gap-2"><div className="w-3 h-3 bg-black rounded-full"></div> Monobank</span>
                                <span className="text-[10px] bg-green-100 text-green-700 px-2 py-0.5 rounded">Active</span>
                            </div>
                            <input type="password" placeholder="X-Token (Masked)" className="w-full bg-white border border-gray-200 rounded p-2 text-xs" disabled value="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" />
                            <button className="mt-2 text-xs text-blue-600 font-bold">–ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –∑'—î–¥–Ω–∞–Ω–Ω—è</button>
                        </div>

                        {/* Nova */}
                        <div className="p-3 bg-gray-50 rounded-xl border border-gray-100">
                            <div className="flex justify-between items-center mb-2">
                                <span className="font-bold flex items-center gap-2"><div className="w-3 h-3 bg-red-600 rounded-full"></div> NovaPay</span>
                                <span className="text-[10px] bg-gray-200 text-gray-500 px-2 py-0.5 rounded">Not Configured</span>
                            </div>
                            <input type="password" placeholder="Client ID / Token" className="w-full bg-white border border-gray-200 rounded p-2 text-xs" />
                        </div>
                    </div>
                </div>

                {/* Automation Rules */}
                <div className="bg-white p-6 rounded-2xl shadow-sm border border-slate-100">
                     <h3 className="font-bold mb-4 flex items-center gap-2 text-sm uppercase text-gray-500">
                        <Icon name="zap" size={16}/> –ê–≤—Ç–æ-–∫–∞—Ç–µ–≥–æ—Ä–∏–∑–∞—Ü—ñ—è
                    </h3>
                    <div className="text-xs text-gray-400 mb-3">–ê–∫—Ç–∏–≤–Ω—ñ –ø—Ä–∞–≤–∏–ª–∞:</div>
                    <div className="flex flex-wrap gap-2">
                        {SMART_RULES.map((rule, i) => (
                            <span key={i} className="text-[10px] bg-latiao-50 border border-latiao-100 text-latiao-900 px-2 py-1 rounded-lg">
                                "{rule.keyword}" ‚Üí {rule.cat}
                            </span>
                        ))}
                    </div>
                </div>
                
                <button onClick={() => signOut(auth)} className="w-full py-4 text-red-500 font-bold bg-white rounded-xl shadow-sm border border-red-50">
                    –í–∏–π—Ç–∏ –∑ —Å–∏—Å—Ç–µ–º–∏
                </button>
            </div>
        );

        // 6. ADD TRANSACTION MODAL
        const AddModal = () => {
            const [form, setForm] = useState({ 
                amount: '', 
                desc: '', 
                cat: '–Ü–Ω—à–µ', 
                source: 'Monobank –§–û–ü', 
                type: modal === 'dividend' ? 'expense' : 'expense',
                isDividend: modal === 'dividend'
            });

            return (
                <div className="fixed inset-0 z-50 bg-black/60 backdrop-blur-sm flex items-end md:items-center justify-center p-4 animate-enter">
                    <div className="bg-white w-full max-w-md rounded-3xl p-6 shadow-2xl">
                        <div className="flex justify-between items-center mb-6">
                            <h3 className="font-bold text-lg">
                                {modal === 'dividend' ? 'üí∏ –î–∏–≤—ñ–¥–µ–Ω–¥–∏' : '–ù–æ–≤–∞ –æ–ø–µ—Ä–∞—Ü—ñ—è'}
                            </h3>
                            <button onClick={() => setModal(null)} className="bg-gray-100 p-2 rounded-full"><Icon name="x" size={16}/></button>
                        </div>

                        {/* Type Switcher */}
                        {modal !== 'dividend' && (
                            <div className="flex bg-gray-100 p-1 rounded-xl mb-4">
                                <button onClick={()=>setForm({...form, type:'income'})} className={`flex-1 py-2 rounded-lg text-sm font-bold transition-all ${form.type==='income'?'bg-emerald-500 text-white shadow-md':'text-gray-500'}`}>–ù–∞–¥—Ö–æ–¥–∂–µ–Ω–Ω—è</button>
                                <button onClick={()=>setForm({...form, type:'expense'})} className={`flex-1 py-2 rounded-lg text-sm font-bold transition-all ${form.type==='expense'?'bg-latiao-500 text-white shadow-md':'text-gray-500'}`}>–í–∏—Ç—Ä–∞—Ç–∞</button>
                            </div>
                        )}

                        <div className="space-y-4">
                            <div>
                                <label className="text-[10px] font-bold text-gray-400 uppercase">–°—É–º–∞</label>
                                <input type="number" value={form.amount} onChange={e=>setForm({...form, amount:Number(e.target.value)})} className="w-full text-4xl font-bold border-b border-gray-200 py-2 focus:border-latiao-500 outline-none" placeholder="0" autoFocus />
                            </div>

                            {modal !== 'dividend' && (
                                <>
                                    <input type="text" value={form.desc} onChange={e=>setForm({...form, desc:e.target.value})} className="w-full bg-gray-50 p-3 rounded-xl text-sm outline-none border border-transparent focus:border-latiao-500" placeholder="–û–ø–∏—Å (Nova Poshta...)" />
                                    <div className="grid grid-cols-2 gap-3">
                                        <select value={form.cat} onChange={e=>setForm({...form, cat:e.target.value})} className="bg-gray-50 p-3 rounded-xl text-sm outline-none">
                                            {CATEGORIES[form.type].map(c => <option key={c} value={c}>{c}</option>)}
                                        </select>
                                        <select value={form.source} onChange={e=>setForm({...form, source:e.target.value})} className="bg-gray-50 p-3 rounded-xl text-sm outline-none">
                                            {ACCOUNTS.map(a => <option key={a.name} value={a.name}>{a.name}</option>)}
                                        </select>
                                    </div>
                                </>
                            )}
                            
                            {modal === 'dividend' && (
                                <div className="bg-orange-50 p-3 rounded-xl border border-orange-100 text-xs text-orange-800">
                                    –¶—è —Å—É–º–∞ –±—É–¥–µ —Å–ø–∏—Å–∞–Ω–∞ –∑ —Ä–∞—Ö—É–Ω–∫—É, –∞–ª–µ –Ω–µ –±—É–¥–µ –≤—Ä–∞—Ö–æ–≤–∞–Ω–∞ —è–∫ –≤–∏—Ç—Ä–∞—Ç–∞ –±—ñ–∑–Ω–µ—Å—É –≤ P&L –∑–≤—ñ—Ç—ñ.
                                </div>
                            )}

                            <button onClick={()=>handleAddTransaction(form)} className="w-full bg-gray-900 text-white py-4 rounded-xl font-bold shadow-lg mt-2">
                                –ü—ñ–¥—Ç–≤–µ—Ä–¥–∏—Ç–∏
                            </button>
                        </div>
                    </div>
                </div>
            );
        };

        // --- NAVIGATION BAR ---
        const NavBar = () => (
            <div className="fixed bottom-0 w-full bg-white border-t border-gray-100 pb-safe z-40">
                <div className="flex justify-around items-center p-2">
                    {[
                        { id: 'dashboard', icon: 'layout-dashboard', label: '–ì–æ–ª–æ–≤–Ω–∞' },
                        { id: 'ops', icon: 'list', label: '–û–ø–µ—Ä–∞—Ü—ñ—ó' },
                        { id: 'pnl', icon: 'pie-chart', label: 'P&L' },
                        { id: 'dividends', icon: 'gem', label: '–î–∏–≤—ñ–¥–µ–Ω–¥–∏' },
                        { id: 'settings', icon: 'settings', label: '–ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è' },
                    ].map(item => (
                        <button key={item.id} onClick={()=>setView(item.id)} className={`flex flex-col items-center p-2 rounded-xl transition-colors ${view===item.id ? 'text-latiao-500 bg-orange-50' : 'text-gray-400'}`}>
                            <Icon name={item.icon} size={20} strokeWidth={view===item.id?2.5:2} />
                            <span className="text-[10px] font-medium mt-1">{item.label}</span>
                        </button>
                    ))}
                </div>
            </div>
        );

        // --- OPS VIEW (Transactions List) ---
        const OpsView = () => (
             <div className="p-4 pb-24 animate-enter">
                <div className="flex justify-between items-center mb-4">
                    <h2 className="text-xl font-bold">–ñ—É—Ä–Ω–∞–ª –æ–ø–µ—Ä–∞—Ü—ñ–π</h2>
                    <div className="flex gap-2">
                        <span className="text-xs bg-white border px-2 py-1 rounded text-gray-500">Filter</span>
                        <span className="text-xs bg-white border px-2 py-1 rounded text-gray-500">Export</span>
                    </div>
                </div>
                <div className="bg-white rounded-2xl shadow-sm border border-slate-100 overflow-hidden">
                    {transactions.map(t => (
                        <div key={t.id} className="p-4 border-b border-slate-50 flex justify-between items-center hover:bg-slate-50">
                            <div className="flex gap-3 items-center">
                                <div className={`w-2 h-10 rounded-full ${t.isDividend ? 'bg-purple-500' : (t.type==='income'?'bg-emerald-500':'bg-latiao-500')}`}></div>
                                <div>
                                    <div className="font-bold text-sm text-gray-800">{t.description || '–ë–µ–∑ –æ–ø–∏—Å—É'}</div>
                                    <div className="text-[10px] text-gray-400 mt-0.5">
                                        <span className="bg-slate-100 px-1.5 py-0.5 rounded text-slate-600 mr-2">{t.cat}</span>
                                        {t.date} ‚Ä¢ {t.source}
                                    </div>
                                </div>
                            </div>
                            <div className="text-right">
                                <div className={`font-bold text-sm ${t.type==='income'?'text-emerald-600':'text-gray-900'}`}>
                                    {t.type==='income'?'+':'-'}{t.amount.toLocaleString()}
                                </div>
                                <button onClick={()=>deleteTx(t.id)} className="text-gray-300 hover:text-red-500 mt-1"><Icon name="trash-2" size={14}/></button>
                            </div>
                        </div>
                    ))}
                </div>
             </div>
        );

        return (
            <div className="max-w-md mx-auto min-h-screen bg-[#F8FAFC] shadow-2xl relative overflow-hidden">
                {view === 'dashboard' && <Dashboard />}
                {view === 'pnl' && <PnLView />}
                {view === 'dividends' && <DividendsView />}
                {view === 'settings' && <SettingsView />}
                {view === 'ops' && <OpsView />}
                
                {view !== 'auth' && <NavBar />}
                {modal && <AddModal />}
            </div>
        );
    };

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<App />);
</script>

</body>
</html>
