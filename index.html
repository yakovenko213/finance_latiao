<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Latiao –§—ñ–Ω–∞–Ω—Å–∏ v2.3 (Calc + Money Rain)</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        
        body { background-color: #F8FAFC; font-family: 'Inter', sans-serif; color: #0F172A; }
        
        /* Custom Colors */
        .text-latiao { color: #FF5722; }
        .bg-latiao { background-color: #FF5722; }
        
        /* Animations */
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .animate-fade-in { animation: fadeIn 0.4s ease-out forwards; }
        
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .spinner {
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top: 2px solid #ffffff;
            width: 20px;
            height: 20px;
            animation: spin 0.8s linear infinite;
        }

        .modal-backdrop {
            background-color: rgba(15, 23, 42, 0.4);
            backdrop-filter: blur(4px);
        }

        /* Money Rain Animation */
        @keyframes fall {
            0% { transform: translateY(-100px) rotate(0deg); opacity: 0; }
            10% { opacity: 1; }
            90% { opacity: 1; }
            100% { transform: translateY(110vh) rotate(360deg); opacity: 0; }
        }
        .coin {
            position: fixed;
            top: -100px;
            width: 50px;
            height: 50px;
            background-image: url('https://img1.picmix.com/output/stamp/normal/0/9/1/1/2691190_5accc.png');
            background-size: contain;
            background-repeat: no-repeat;
            z-index: 9999;
            pointer-events: none;
            animation: fall linear infinite;
        }
        
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #CBD5E1; border-radius: 3px; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo, useRef } = React;

        // --- ICONS ---
        const Icons = {
            Dashboard: () => <svg width="20" height="20" fill="none" stroke="currentColor" strokeWidth="2" viewBox="0 0 24 24"><rect x="3" y="3" width="7" height="7"></rect><rect x="14" y="3" width="7" height="7"></rect><rect x="14" y="14" width="7" height="7"></rect><rect x="3" y="14" width="7" height="7"></rect></svg>,
            List: () => <svg width="20" height="20" fill="none" stroke="currentColor" strokeWidth="2" viewBox="0 0 24 24"><line x1="8" y1="6" x2="21" y2="6"></line><line x1="8" y1="12" x2="21" y2="12"></line><line x1="8" y1="18" x2="21" y2="18"></line><line x1="3" y1="6" x2="3.01" y2="6"></line><line x1="3" y1="12" x2="3.01" y2="12"></line><line x1="3" y1="18" x2="3.01" y2="18"></line></svg>,
            PieChart: () => <svg width="20" height="20" fill="none" stroke="currentColor" strokeWidth="2" viewBox="0 0 24 24"><path d="M21.21 15.89A10 10 0 1 1 8 2.83"></path><path d="M22 12A10 10 0 0 0 12 2v10z"></path></svg>,
            ArrowUpRight: () => <svg width="20" height="20" fill="none" stroke="currentColor" strokeWidth="2" viewBox="0 0 24 24"><line x1="7" y1="17" x2="17" y2="7"></line><polyline points="7 7 17 7 17 17"></polyline></svg>,
            DollarSign: () => <svg width="20" height="20" fill="none" stroke="currentColor" strokeWidth="2" viewBox="0 0 24 24"><line x1="12" y1="1" x2="12" y2="23"></line><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path></svg>,
            Settings: () => <svg width="20" height="20" fill="none" stroke="currentColor" strokeWidth="2" viewBox="0 0 24 24"><circle cx="12" cy="12" r="3"></circle><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path></svg>,
            Check: () => <svg width="12" height="12" fill="none" stroke="currentColor" strokeWidth="3" viewBox="0 0 24 24"><polyline points="20 6 9 17 4 12"></polyline></svg>,
            Alert: () => <svg width="14" height="14" fill="none" stroke="currentColor" strokeWidth="2" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="8" x2="12" y2="12"></line><line x1="12" y1="16" x2="12.01" y2="16"></line></svg>,
            IncomeArrow: () => <svg width="16" height="16" fill="none" stroke="currentColor" strokeWidth="2" viewBox="0 0 24 24"><line x1="7" y1="7" x2="17" y2="17"></line><polyline points="17 7 17 17 7 17"></polyline></svg>,
            ExpenseArrow: () => <svg width="16" height="16" fill="none" stroke="currentColor" strokeWidth="2" viewBox="0 0 24 24"><line x1="7" y1="17" x2="17" y2="7"></line><polyline points="7 7 17 7 17 17"></polyline></svg>,
            Search: () => <svg width="18" height="18" fill="none" stroke="currentColor" strokeWidth="2" viewBox="0 0 24 24"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>,
            Calculator: () => <svg width="24" height="24" fill="none" stroke="currentColor" strokeWidth="2" viewBox="0 0 24 24"><rect x="4" y="2" width="16" height="20" rx="2"></rect><line x1="8" y1="6" x2="16" y2="6"></line><line x1="16" y1="14" x2="16" y2="18"></line><path d="M16 10h.01"></path><path d="M12 10h.01"></path><path d="M8 10h.01"></path><path d="M12 14h.01"></path><path d="M8 14h.01"></path><path d="M12 18h.01"></path><path d="M8 18h.01"></path></svg>,
            X: () => <svg width="20" height="20" fill="none" stroke="currentColor" strokeWidth="2" viewBox="0 0 24 24"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
        };

        const LOGO_MONO = "https://multicast.com.ua/wp-content/uploads/2024/04/monobank-logo.png";
        const LOGO_NOVA = "https://novapay.credit/wp-content/uploads/2023/10/cropped-cropped-logo.png";
        
        const CATEGORIES = {
            income: ['–ü—Ä–æ–¥–∞–∂—ñ', '–ö–µ—à–±–µ–∫', '–Ü–Ω–≤–µ—Å—Ç–∏—Ü—ñ—ó', '–ü–æ–≤–µ—Ä–Ω–µ–Ω–Ω—è', '–Ü–Ω—à–µ'],
            expense: ['–ó–∞–∫—É–ø—ñ–≤–ª—è (COGS)', '–†–µ–∫–ª–∞–º–∞ (Ads)', '–î–æ—Å—Ç–∞–≤–∫–∞ (–õ–æ–≥—ñ—Å—Ç–∏–∫–∞)', '–ü–∞–∫—É–≤–∞–Ω–Ω—è', '–ö–æ–º—ñ—Å—ñ—ó', '–ü–æ–¥–∞—Ç–∫–∏', '–û—Ä–µ–Ω–¥–∞', '–ó–∞—Ä–ø–ª–∞—Ç–∞', '–°–µ—Ä–≤—ñ—Å–∏', '–Ü–Ω—à–µ']
        };

        const safeJSONParse = (key, fallback) => {
            try { return JSON.parse(localStorage.getItem(key)) || fallback; } 
            catch { return fallback; }
        };

        // --- COMPONENTS ---

        // 1. Screensaver Component
        const MoneyRain = ({ enabled }) => {
            const [coins, setCoins] = useState([]);

            useEffect(() => {
                if (enabled) {
                    // Generate 30 coins with random delays and positions
                    const newCoins = Array.from({ length: 30 }).map((_, i) => ({
                        id: i,
                        left: Math.random() * 100 + '%',
                        delay: Math.random() * 5 + 's',
                        duration: (Math.random() * 3 + 2) + 's'
                    }));
                    setCoins(newCoins);
                }
            }, [enabled]);

            if (!enabled) return null;

            return (
                <div className="fixed inset-0 z-[9999] pointer-events-none overflow-hidden bg-black/20 backdrop-blur-sm">
                    {coins.map(coin => (
                        <div 
                            key={coin.id} 
                            className="coin" 
                            style={{ 
                                left: coin.left, 
                                animationDelay: coin.delay,
                                animationDuration: coin.duration
                            }}
                        />
                    ))}
                    <div className="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 text-white font-bold text-2xl drop-shadow-md animate-pulse">
                        –†—É—Ö–∞–π –º–∏—à–∫–æ—é, —â–æ–± –ø—Ä–∞—Ü—é–≤–∞—Ç–∏! üíº
                    </div>
                </div>
            );
        };

        // 2. Calculator Component
        const Calculator = ({ onClose }) => {
            const [display, setDisplay] = useState('0');
            const [expression, setExpression] = useState('');
            const [prevValue, setPrevValue] = useState(null);
            const [operator, setOperator] = useState(null);
            const [waitingForOperand, setWaitingForOperand] = useState(false);

            const inputDigit = (digit) => {
                if (waitingForOperand) {
                    setDisplay(String(digit));
                    setWaitingForOperand(false);
                } else {
                    setDisplay(display === '0' ? String(digit) : display + digit);
                }
            };

            const performOperation = (nextOperator) => {
                const inputValue = parseFloat(display);

                if (prevValue == null) {
                    setPrevValue(inputValue);
                } else if (operator) {
                    const currentValue = prevValue || 0;
                    const newValue = calculate(currentValue, inputValue, operator);
                    setPrevValue(newValue);
                    setDisplay(String(newValue));
                }

                setWaitingForOperand(true);
                setOperator(nextOperator);
            };

            const calculate = (first, second, op) => {
                switch(op) {
                    case '+': return first + second;
                    case '-': return first - second;
                    case '*': return first * second;
                    case '/': return first / second;
                    case '=': return second;
                    default: return second;
                }
            };

            const handleEqual = () => {
                performOperation('=');
                setOperator(null);
                setPrevValue(null);
            };

            const clear = () => {
                setDisplay('0');
                setPrevValue(null);
                setOperator(null);
                setWaitingForOperand(false);
            };

            const Btn = ({ v, onClick, bg = "bg-slate-100", text = "text-slate-800" }) => (
                <button 
                    onClick={onClick}
                    className={`${bg} ${text} rounded-lg p-4 font-bold text-lg hover:brightness-95 active:scale-95 transition-all shadow-sm`}
                >
                    {v}
                </button>
            );

            return (
                <div className="fixed inset-0 z-50 flex items-center justify-center modal-backdrop p-4">
                    <div className="bg-white rounded-2xl shadow-2xl w-full max-w-xs overflow-hidden animate-fade-in border border-slate-200">
                        <div className="bg-slate-900 p-4 flex justify-between items-center">
                            <h3 className="text-white font-bold flex items-center gap-2"><Icons.Calculator /> –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä</h3>
                            <button onClick={onClose} className="text-white hover:text-orange-500"><Icons.X /></button>
                        </div>
                        <div className="p-4 bg-slate-50 border-b border-slate-200 text-right">
                             <div className="text-3xl font-mono font-bold text-slate-800 truncate">{display}</div>
                        </div>
                        <div className="p-4 grid grid-cols-4 gap-3 bg-white">
                            <Btn v="C" onClick={clear} bg="bg-red-50" text="text-red-500" />
                            <Btn v="/" onClick={() => performOperation('/')} bg="bg-orange-50" text="text-orange-600" />
                            <Btn v="*" onClick={() => performOperation('*')} bg="bg-orange-50" text="text-orange-600" />
                            <Btn v="-" onClick={() => performOperation('-')} bg="bg-orange-50" text="text-orange-600" />
                            
                            <Btn v="7" onClick={() => inputDigit(7)} />
                            <Btn v="8" onClick={() => inputDigit(8)} />
                            <Btn v="9" onClick={() => inputDigit(9)} />
                            <Btn v="+" onClick={() => performOperation('+')} bg="bg-orange-50" text="text-orange-600" />

                            <Btn v="4" onClick={() => inputDigit(4)} />
                            <Btn v="5" onClick={() => inputDigit(5)} />
                            <Btn v="6" onClick={() => inputDigit(6)} />
                            <Btn v="=" onClick={handleEqual} bg="bg-latiao row-span-2 flex items-center justify-center" text="text-white" />

                            <Btn v="1" onClick={() => inputDigit(1)} />
                            <Btn v="2" onClick={() => inputDigit(2)} />
                            <Btn v="3" onClick={() => inputDigit(3)} />
                            
                            <Btn v="0" onClick={() => inputDigit(0)} bg="col-span-2 bg-slate-100" />
                            <Btn v="." onClick={() => inputDigit('.')} />
                        </div>
                    </div>
                </div>
            );
        };

        const Sidebar = ({ activeTab, setActiveTab, connections }) => (
            <div className="w-64 bg-white h-screen fixed left-0 top-0 border-r border-slate-200 flex flex-col z-20">
                <div className="p-8 flex items-center gap-3">
                    <div className="w-10 h-10 bg-latiao rounded-xl flex items-center justify-center text-white font-bold text-xl shadow-lg shadow-orange-200">L</div>
                    <div>
                        <h1 className="text-lg font-bold text-slate-800 leading-tight">Latiao</h1>
                        <div className="text-xs text-slate-400 font-medium tracking-wide">FINANCE</div>
                    </div>
                </div>
                <nav className="flex-1 px-4 space-y-1">
                    {[
                        { id: '–î–∞—à–±–æ—Ä–¥', icon: Icons.Dashboard },
                        { id: '–û–ø–µ—Ä–∞—Ü—ñ—ó', icon: Icons.List },
                        { id: 'P&L –ó–≤—ñ—Ç', icon: Icons.PieChart },
                        { id: 'Cash Flow', icon: Icons.ArrowUpRight },
                        { id: '–î–∏–≤—ñ–¥–µ–Ω–¥–∏', icon: Icons.DollarSign },
                    ].map((item) => (
                        <div key={item.id} onClick={() => setActiveTab(item.id)}
                            className={`flex items-center gap-3 p-3 rounded-xl cursor-pointer transition-all duration-200 group
                            ${activeTab === item.id ? 'bg-orange-50 text-latiao font-semibold' : 'text-slate-500 hover:bg-slate-50 hover:text-slate-800'}`}>
                            <div className={activeTab === item.id ? 'text-latiao' : 'text-slate-400 group-hover:text-slate-600'}>
                                <item.icon />
                            </div>
                            {item.id}
                        </div>
                    ))}
                    
                    <div className="pt-4 mt-4 border-t border-slate-100">
                        <div onClick={() => setActiveTab('–ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è')}
                            className={`flex items-center gap-3 p-3 rounded-xl cursor-pointer transition-all duration-200
                            ${activeTab === '–ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è' ? 'bg-slate-100 text-slate-800 font-semibold' : 'text-slate-500 hover:bg-slate-50 hover:text-slate-800'}`}>
                            <Icons.Settings />
                            –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è
                        </div>
                    </div>
                </nav>
            </div>
        );

        const KPI = ({ title, value, subtext, trend }) => (
            <div className="bg-white p-6 rounded-2xl shadow-sm border border-slate-100 hover:shadow-md transition-all duration-300 group">
                <div className="flex justify-between items-start mb-2">
                    <div className="text-slate-500 text-sm font-medium">{title}</div>
                    {trend && (
                        <span className={`text-xs px-2 py-1 rounded-full ${trend === 'up' ? 'bg-green-50 text-green-600' : 'bg-red-50 text-red-600'}`}>
                            {trend === 'up' ? '‚ñ≤ +12%' : '‚ñº -5%'}
                        </span>
                    )}
                </div>
                <div className="text-3xl font-bold text-slate-800 mb-1 group-hover:text-latiao transition-colors">{value}</div>
                {subtext && <div className="text-xs text-slate-400">{subtext}</div>}
            </div>
        );

        const FilterBar = ({ search, setSearch, typeFilter, setTypeFilter, sort, setSort }) => (
            <div className="bg-white p-4 rounded-xl shadow-sm border border-slate-200 mb-6 flex flex-col md:flex-row gap-4 items-center justify-between animate-fade-in">
                <div className="relative w-full md:w-1/3">
                    <div className="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none text-slate-400"><Icons.Search /></div>
                    <input type="text" placeholder="–ü–æ—à—É–∫..." value={search} onChange={(e) => setSearch(e.target.value)}
                        className="w-full pl-10 pr-4 py-2.5 border border-slate-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-orange-500/20 focus:border-orange-500 transition-all" />
                </div>
                <div className="flex gap-2 w-full md:w-auto overflow-x-auto pb-1 md:pb-0">
                    <select value={typeFilter} onChange={(e) => setTypeFilter(e.target.value)} className="bg-slate-50 border border-slate-200 text-slate-700 text-sm rounded-lg focus:ring-orange-500 focus:border-orange-500 block p-2.5">
                        <option value="all">–í—Å—ñ —Ç–∏–ø–∏</option>
                        <option value="income">–¢—ñ–ª—å–∫–∏ –î–æ—Ö–æ–¥–∏</option>
                        <option value="expense">–¢—ñ–ª—å–∫–∏ –í–∏—Ç—Ä–∞—Ç–∏</option>
                    </select>
                    <select value={sort} onChange={(e) => setSort(e.target.value)} className="bg-slate-50 border border-slate-200 text-slate-700 text-sm rounded-lg focus:ring-orange-500 focus:border-orange-500 block p-2.5">
                        <option value="dateDesc">–°–ø–æ—á–∞—Ç–∫—É –Ω–æ–≤—ñ</option>
                        <option value="dateAsc">–°–ø–æ—á–∞—Ç–∫—É —Å—Ç–∞—Ä—ñ</option>
                        <option value="amountDesc">–°–ø–æ—á–∞—Ç–∫—É –≤–µ–ª–∏–∫—ñ</option>
                        <option value="amountAsc">–°–ø–æ—á–∞—Ç–∫—É –º–∞–ª—ñ</option>
                    </select>
                </div>
            </div>
        );

        const Settings = ({ connections, onConnect, settings, onUpdateSettings }) => {
            const [step, setStep] = useState('token');
            const [key, setKey] = useState('');
            
            return (
                <div className="max-w-3xl animate-fade-in pb-20">
                    <h2 className="text-3xl font-bold text-slate-800 mb-2">–ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è</h2>
                    
                    <div className="mt-6 bg-white rounded-2xl shadow-sm border border-slate-200 overflow-hidden">
                         <div className="p-6 border-b border-slate-100">
                            <h3 className="font-bold text-slate-800">–Ü–Ω—Ç–µ—Ä—Ñ–µ–π—Å</h3>
                        </div>
                        <div className="p-6 flex items-center justify-between">
                            <div>
                                <div className="text-sm font-bold text-slate-800">–†–µ–∂–∏–º –ø–∞–¥–∞—é—á–∏—Ö –º–æ–Ω–µ—Ç (–ó–∞—Å—Ç–∞–≤–∫–∞)</div>
                                <div className="text-xs text-slate-500">–í–º–∏–∫–∞—î—Ç—å—Å—è —á–µ—Ä–µ–∑ 1 —Ö–≤ –±–µ–∑–¥—ñ—è–ª—å–Ω–æ—Å—Ç—ñ</div>
                            </div>
                            <label className="relative inline-flex items-center cursor-pointer">
                                <input type="checkbox" checked={settings.screensaver} onChange={(e) => onUpdateSettings({ ...settings, screensaver: e.target.checked })} className="sr-only peer" />
                                <div className="w-11 h-6 bg-slate-200 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-latiao"></div>
                            </label>
                        </div>
                    </div>

                    <div className="mt-6 bg-white rounded-2xl shadow-sm border border-slate-200 overflow-hidden">
                        <div className="p-6 border-b border-slate-100 flex items-center gap-4">
                            <img src={LOGO_MONO} className="w-8 h-8 object-contain" />
                            <h3 className="font-bold text-slate-800">Monobank API</h3>
                            {connections.mono && <span className="ml-auto bg-green-100 text-green-700 px-3 py-1 rounded-full text-xs font-bold">ACTIVE</span>}
                        </div>
                        <div className="p-8">
                             {!connections.mono ? (
                                <div className="space-y-4 max-w-md">
                                    <input type="password" value={key} onChange={(e) => setKey(e.target.value)} 
                                        className="w-full p-4 border rounded-xl" placeholder="–í–≤–µ–¥—ñ—Ç—å X-Token..." />
                                    <button onClick={() => onConnect('mono', key, 'acc_demo')} disabled={!key} 
                                        className="w-full py-3 bg-slate-900 text-white rounded-xl font-bold">–ü—ñ–¥–∫–ª—é—á–∏—Ç–∏</button>
                                </div>
                            ) : (
                                <div className="text-center py-4">
                                    <div className="text-green-600 font-bold mb-4">‚úì –ü—ñ–¥–∫–ª—é—á–µ–Ω–æ</div>
                                    <button onClick={() => window.location.reload()} className="text-red-500 border border-red-200 px-4 py-2 rounded">–í—ñ–¥–∫–ª—é—á–∏—Ç–∏</button>
                                </div>
                            )}
                        </div>
                    </div>
                </div>
            );
        };

        const App = () => {
            const [activeTab, setActiveTab] = useState('–û–ø–µ—Ä–∞—Ü—ñ—ó');
            const [transactions, setTransactions] = useState(() => safeJSONParse('latiao_v2_tx', []));
            const [connections, setConnections] = useState(() => safeJSONParse('latiao_v2_conn', { mono: false }));
            const [settings, setSettings] = useState(() => safeJSONParse('latiao_settings', { screensaver: true }));
            
            const [isIdle, setIsIdle] = useState(false);
            const [showCalculator, setShowCalculator] = useState(false);
            const idleTimerRef = useRef(null);

            // Filter States
            const [searchTerm, setSearchTerm] = useState('');
            const [filterType, setFilterType] = useState('all');
            const [sortBy, setSortBy] = useState('dateDesc');

            useEffect(() => localStorage.setItem('latiao_settings', JSON.stringify(settings)), [settings]);

            // IDLE TIMER LOGIC
            const resetIdleTimer = () => {
                setIsIdle(false);
                if (idleTimerRef.current) clearTimeout(idleTimerRef.current);
                if (settings.screensaver) {
                    idleTimerRef.current = setTimeout(() => setIsIdle(true), 60000); // 1 minute
                }
            };

            useEffect(() => {
                window.addEventListener('mousemove', resetIdleTimer);
                window.addEventListener('keydown', resetIdleTimer);
                window.addEventListener('click', resetIdleTimer);
                resetIdleTimer(); // Init
                return () => {
                    window.removeEventListener('mousemove', resetIdleTimer);
                    window.removeEventListener('keydown', resetIdleTimer);
                    window.removeEventListener('click', resetIdleTimer);
                    if (idleTimerRef.current) clearTimeout(idleTimerRef.current);
                };
            }, [settings.screensaver]);

            const handleConnection = async (type, token, accountId) => {
                 setConnections({ mono: true });
            };

            const filteredTransactions = useMemo(() => {
                return transactions
                    .filter(t => {
                        const matchesSearch = t.description.toLowerCase().includes(searchTerm.toLowerCase()) || 
                                              (t.category && t.category.toLowerCase().includes(searchTerm.toLowerCase()));
                        const matchesType = filterType === 'all' || t.type === filterType;
                        return matchesSearch && matchesType;
                    })
                    .sort((a, b) => {
                        if (sortBy === 'dateDesc') return new Date(b.date) - new Date(a.date);
                        if (sortBy === 'dateAsc') return new Date(a.date) - new Date(b.date);
                        if (sortBy === 'amountDesc') return Math.abs(b.amount) - Math.abs(a.amount);
                        return 0;
                    });
            }, [transactions, searchTerm, filterType, sortBy]);

            return (
                <div className="flex min-h-screen">
                    <MoneyRain enabled={isIdle && settings.screensaver} />
                    
                    <Sidebar activeTab={activeTab} setActiveTab={setActiveTab} connections={connections} />
                    
                    <main className="flex-1 ml-64 p-10 overflow-y-auto h-screen relative">
                        <header className="flex justify-between items-center mb-10 animate-fade-in">
                            <div>
                                <h2 className="text-3xl font-bold text-slate-800">{activeTab}</h2>
                                <p className="text-slate-400 mt-1 text-sm font-medium">–°—å–æ–≥–æ–¥–Ω—ñ: {new Date().toLocaleDateString('uk-UA')}</p>
                            </div>
                            <div className="flex items-center gap-4 bg-white p-2 pr-4 rounded-full border border-slate-200 shadow-sm">
                                <div className="w-10 h-10 bg-slate-900 rounded-full flex items-center justify-center text-white font-bold">R</div>
                                <div className="text-sm"><div className="font-bold text-slate-800">–†—É—Å–ª–∞–Ω</div></div>
                            </div>
                        </header>

                        {activeTab === '–û–ø–µ—Ä–∞—Ü—ñ—ó' && (
                            <div className="animate-fade-in">
                                <FilterBar search={searchTerm} setSearch={setSearchTerm} typeFilter={filterType} setTypeFilter={setFilterType} sort={sortBy} setSort={setSortBy} />
                                <div className="bg-white rounded-2xl shadow-sm border border-slate-200 overflow-hidden">
                                     <table className="w-full">
                                        <thead className="bg-slate-50 border-b border-slate-100">
                                            <tr>
                                                <th className="p-5 text-left text-xs font-bold text-slate-500 uppercase">–î–∞—Ç–∞</th>
                                                <th className="p-5 text-left text-xs font-bold text-slate-500 uppercase">–û–ø–∏—Å</th>
                                                <th className="p-5 text-right text-xs font-bold text-slate-500 uppercase">–°—É–º–∞</th>
                                            </tr>
                                        </thead>
                                        <tbody className="divide-y divide-slate-100">
                                            {filteredTransactions.length === 0 ? (
                                                <tr><td colSpan="3" className="p-10 text-center text-slate-400">–ù–µ–º–∞—î –¥–∞–Ω–∏—Ö</td></tr>
                                            ) : filteredTransactions.map(t => (
                                                <tr key={t.id} className="hover:bg-slate-50">
                                                    <td className="p-5 text-sm text-slate-500">{t.date}</td>
                                                    <td className="p-5 text-sm font-medium text-slate-700">{t.description}</td>
                                                    <td className={`p-5 text-right font-bold text-sm ${t.type === 'income' ? 'text-green-600' : 'text-slate-800'}`}>
                                                        {t.amount} ‚Ç¥
                                                    </td>
                                                </tr>
                                            ))}
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        )}

                        {activeTab === '–ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è' && <Settings connections={connections} onConnect={handleConnection} settings={settings} onUpdateSettings={setSettings} />}
                        
                        {/* Floating Calculator Button */}
                        <button 
                            onClick={() => setShowCalculator(true)}
                            className="fixed bottom-8 right-8 bg-latiao text-white p-4 rounded-full shadow-lg hover:bg-orange-600 hover:scale-110 transition-all z-40 group"
                        >
                            <Icons.Calculator />
                            <span className="absolute right-full mr-3 top-1/2 -translate-y-1/2 bg-slate-800 text-white text-xs px-2 py-1 rounded opacity-0 group-hover:opacity-100 transition-opacity whitespace-nowrap pointer-events-none">–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä</span>
                        </button>

                    </main>

                    {showCalculator && <Calculator onClose={() => setShowCalculator(false)} />}
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
